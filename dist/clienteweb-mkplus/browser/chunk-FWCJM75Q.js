import{a as Z}from"./chunk-3QEI6ENN.js";import{g as G,h as q,u as J,v as O}from"./chunk-Z5HBHXP3.js";import{a as L,b as F,d as U,g as W,i as D,m as z,n as j,p as B,u as H}from"./chunk-YPYZVSIH.js";import{a as k}from"./chunk-I2A4HNRV.js";import{x as P}from"./chunk-JJK3Y3Z5.js";import{Bb as m,Db as u,Ea as s,Ob as n,Pb as p,Qb as I,Va as M,Vb as b,Wb as v,X as N,Xb as f,aa as d,fa as V,fb as R,ga as g,gb as w,hb as T,jb as E,kb as C,lb as _,mb as a,nb as i,ob as y,ub as x}from"./chunk-XFJKNVDY.js";import{h as S}from"./chunk-FJYW2LMB.js";var h=class l{http=d(P);servicio=`${k.api}${k.paths.variables}`;consultarVariables=()=>{try{return this.http.post(this.servicio+"/consulta",{})}catch(t){return t}};crearVariable=t=>{try{return this.http.post(this.servicio+"/crear",t)}catch(e){return e}};eliminarVariable=t=>{try{return this.http.post(this.servicio+"/eliminar",t)}catch(e){return e}};actualizarVariable=t=>{try{return this.http.post(this.servicio+"/actualizar",t)}catch(e){return e}};static \u0275fac=function(e){return new(e||l)};static \u0275prov=N({token:l,factory:l.\u0275fac,providedIn:"root"})};var Q={nombre:"",descripcion:"",precedencia:0,valor:{numero:0,tipo:""},activo:!1,aplicaPara:""};var X=[{value:"PORCENTAJE",text:"Porcentaje",key:1},{value:"FACTOR",text:"Factor",key:2},{value:"NUMERICO",text:"Numerico",key:3}];var Y=[{value:"VALOR FUTURO",text:"Valor futuro",key:1},{value:"VALOR ACTUAL",text:"Valor actual",key:2}];function te(l,t){if(l&1&&(a(0,"option",15),n(1),i()),l&2){let e=t.$implicit;_("value",e.value),s(),p(e.text)}}function ie(l,t){if(l&1&&(a(0,"option",15),n(1),i()),l&2){let e=t.$implicit;_("value",e.value),s(),p(e.text)}}function ae(l,t){if(l&1){let e=x();a(0,"button",22),m("click",function(){V(e);let c=u();return g(c.actualizar())}),n(1),i()}if(l&2){let e=u();s(),I(" ",e.cargando?"Actualizando...":"Actualizar"," ")}}function re(l,t){if(l&1){let e=x();a(0,"button",22),m("click",function(){V(e);let c=u();return g(c.guardar())}),n(1),i()}if(l&2){let e=u();s(),I(" ",e.cargando?"Guardando...":"Guardar"," ")}}var A=class l{modalActivo=d(G);variablesService=d(h);utilidadesService=d(O);tipoValor=X;tipoAplicaPara=Y;datosVariable=Object.assign({},Q);evento="EVENTO_GUARDAR";cargando=!1;guardar=()=>{this.cargando=!0,this.variablesService.crearVariable(this.datosVariable).subscribe({next:t=>{this.cargando=!1,t.estatus?this.utilidadesService.abrirModalInfo("Informaci\xF3n",`Variable ${this.datosVariable.nombre} creado con \xE9xito.`,"Aceptar"):this.utilidadesService.abrirModalInfo("Informaci\xF3n",t.resultadoOperacion,"Aceptar"),this.cargando=!1,this.modalActivo.close(!0)},error:t=>{this.cargando=!1,this.utilidadesService.abrirModalInfo("Informaci\xF3n",t.error.resultadoOperacion,"Aceptar")}})};actualizar=()=>{this.cargando=!0,delete this.datosVariable.creado,delete this.datosVariable.actualizado,"__v"in this.datosVariable&&delete this.datosVariable.__v,"editado"in this.datosVariable&&delete this.datosVariable.editado,this.variablesService.actualizarVariable(this.datosVariable).subscribe({next:t=>{this.cargando=!1,t.estatus?(this.utilidadesService.abrirModalInfo("Informaci\xF3n",`Variable ${this.datosVariable.nombre} actualizado con \xE9xito.`,"Aceptar"),this.modalActivo.close(!0)):this.utilidadesService.abrirModalInfo("Informaci\xF3n",t.resultadoOperacion,"Aceptar"),this.cargando=!1},error:t=>{this.cargando=!1,this.utilidadesService.abrirModalInfo("Informaci\xF3n",t.error.resultadoOperacion,"Aceptar")}})};static \u0275fac=function(e){return new(e||l)};static \u0275cmp=M({type:l,selectors:[["app-modal-variables"]],inputs:{datosVariable:"datosVariable",evento:"evento"},decls:54,vars:9,consts:[["tabindex","-1","aria-modal","true","role","dialog",1,"modal","fade","show",2,"display","block"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-3"],[1,"row","g-3","mb-3"],[1,"col-md-6"],[1,"form-label"],[1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-3"],["type","number",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-select",3,"ngModelChange","ngModel"],[3,"value"],[1,"col-md-8","form-check","form-switch","d-flex","align-items-center","gap-2","ms-2"],["type","checkbox","role","switch","id","estadoModelo",1,"form-check-input",3,"ngModelChange","ngModel"],[1,"form-check-label","fw-medium"],[1,"modal-footer"],["type","button",1,"btn","boton-secondary-kia",3,"click"],["type","button",1,"btn","boton-principal-kia"],["type","button",1,"btn","boton-principal-kia",3,"click"]],template:function(e,r){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),n(5," Formulario variables "),i(),a(6,"button",5),m("click",function(){return r.modalActivo.close(!1)}),i()(),a(7,"div",6)(8,"h6",7),n(9,"Descripci\xF3n"),i(),a(10,"div",8)(11,"div",9)(12,"label",10),n(13,"Nombre"),i(),a(14,"input",11),f("ngModelChange",function(o){return v(r.datosVariable.nombre,o)||(r.datosVariable.nombre=o),o}),i()(),a(15,"div",9)(16,"label",10),n(17,"Descripci\xF3n"),i(),a(18,"input",11),f("ngModelChange",function(o){return v(r.datosVariable.descripcion,o)||(r.datosVariable.descripcion=o),o}),i()()(),a(19,"h6",7),n(20,"Datos"),i(),a(21,"div",8)(22,"div",12)(23,"label",10),n(24,"Valor"),i(),a(25,"input",13),f("ngModelChange",function(o){return v(r.datosVariable.valor.numero,o)||(r.datosVariable.valor.numero=o),o}),i()(),a(26,"div",12)(27,"label",10),n(28,"Tipo"),i(),a(29,"select",14),f("ngModelChange",function(o){return v(r.datosVariable.valor.tipo,o)||(r.datosVariable.valor.tipo=o),o}),E(30,te,2,2,"option",15,T),i()(),a(32,"div",12)(33,"label",10),n(34,"Aplica para"),i(),a(35,"select",14),f("ngModelChange",function(o){return v(r.datosVariable.aplicaPara,o)||(r.datosVariable.aplicaPara=o),o}),E(36,ie,2,2,"option",15,T),i()(),a(38,"div",12)(39,"label",10),n(40,"Precedencia"),i(),a(41,"input",13),f("ngModelChange",function(o){return v(r.datosVariable.precedencia,o)||(r.datosVariable.precedencia=o),o}),i()()(),a(42,"h6",7),n(43,"Activacion De Variable"),i(),a(44,"div",8)(45,"div",16)(46,"input",17),f("ngModelChange",function(o){return v(r.datosVariable.activo,o)||(r.datosVariable.activo=o),o}),i(),a(47,"label",18),n(48," Si la variable esta desactivada, no estar\xE1 disponible en la oferta comercial "),i()()()(),a(49,"div",19)(50,"button",20),m("click",function(){return r.modalActivo.close(!1)}),n(51," CANCELAR "),i(),R(52,ae,2,1,"button",21),R(53,re,2,1,"button",21),i()()()()),e&2&&(s(14),b("ngModel",r.datosVariable.nombre),s(4),b("ngModel",r.datosVariable.descripcion),s(7),b("ngModel",r.datosVariable.valor.numero),s(4),b("ngModel",r.datosVariable.valor.tipo),s(),C(r.tipoValor),s(5),b("ngModel",r.datosVariable.aplicaPara),s(),C(r.tipoAplicaPara),s(5),b("ngModel",r.datosVariable.precedencia),s(5),b("ngModel",r.datosVariable.activo),s(6),w(r.evento==="EVENTO_ACTUALIZAR"?52:-1),s(),w(r.evento==="EVENTO_GUARDAR"?53:-1))},dependencies:[H,j,B,F,D,L,z,U,W],encapsulation:2})};var ne=(l,t)=>t._id;function oe(l,t){if(l&1){let e=x();a(0,"tr")(1,"td",14),n(2),i(),a(3,"td"),n(4),i(),a(5,"td"),n(6),i(),a(7,"td",14),n(8),i(),a(9,"td",14),n(10),i(),a(11,"td",15)(12,"div",16),y(13,"input",17),i()(),a(14,"td",15)(15,"div",18)(16,"button",19),m("click",function(){let c=V(e).$implicit,o=u();return g(o.actualizar(c))}),y(17,"i",20),n(18," Editar "),i(),a(19,"button",21),m("click",function(){let c=V(e).$implicit,o=u();return g(o.eliminarVariable(c))}),y(20,"i",22),n(21," Eliminar "),i()()()()}if(l&2){let e=t.$implicit;s(2),p(e.nombre),s(2),p(e.descripcion),s(2),p(e.valor.numero),s(2),p(e.valor.tipo),s(2),p(e.aplicaPara),s(3),_("checked",e.activo)}}function le(l,t){l&1&&(a(0,"tr")(1,"td",23),n(2," No hay registros para mostrar "),i()())}var $=class l{variablesService=d(h);utilidadesService=d(O);modalService=d(q);cargando=!1;variables=[];ngOnInit(){this.consultar()}crear=()=>S(this,null,function*(){let t=this.modalService.open(A,{centered:!0,size:"l"});t.componentInstance.evento="EVENTO_GUARDAR",(yield t.result)&&this.consultar()});actualizar=t=>S(this,null,function*(){let e=this.modalService.open(A,{centered:!0,size:"l"});e.componentInstance.evento="EVENTO_ACTUALIZAR",e.componentInstance.datosVariable=t,(yield e.result)&&this.consultar()});eliminarVariable=t=>S(this,null,function*(){this.utilidadesService.abrirModalConfirmacion("Eliminar variable",`Estas seguro que quieres eliminar la variable ${t.descripcion}?`,"Eliminar","Cancelar").then(e=>{e&&this.eliminar(t._id??"")})});eliminar=t=>{this.variablesService.eliminarVariable({id:t}).subscribe({next:e=>{e.estatus&&this.utilidadesService.abrirModalInfo("Informaci\xF3n",e.resultadoOperacion,"Aceptar"),this.cargando=!1,this.consultar()},error:e=>{this.utilidadesService.abrirModalInfo("Informaci\xF3n",e.error.resultadoOperacion,"Aceptar"),this.cargando=!1}})};consultar=()=>S(this,null,function*(){this.cargando=!0,this.variablesService.consultarVariables().subscribe({next:t=>{this.cargando=!1,t.estatus?this.variables=t.data:this.utilidadesService.abrirModalInfo("Informaci\xF3n",t.resultadoOperacion,"Aceptar")},error:t=>{this.cargando=!1,this.utilidadesService.abrirModalInfo("Informaci\xF3n",t.error.resultadoOperacion,"Aceptar")}})});static \u0275fac=function(e){return new(e||l)};static \u0275cmp=M({type:l,selectors:[["app-variables"]],decls:36,vars:4,consts:[[3,"messageInput","loading"],[1,"container","py-5","mt-5"],[1,"d-flex","flex-column","flex-md-row","justify-content-between","align-items-md-center","mb-4"],[1,"fw-bold","text-dark","mb-1"],[1,"text-muted","mb-0"],[1,"btn","boton-principal-kia","mt-3",3,"click"],[1,"card","border-0","shadow-sm","rounded-4"],[1,"table-responsive"],[1,"table","align-middle","mb-0"],[1,"table-light"],[1,"fw-semibold"],[1,"fw-semibold","text-center"],[1,"card-footer","d-flex","justify-content-between","align-items-center"],[1,"text-muted"],[1,"text-uppercase"],[1,"text-center"],[1,"form-check","form-switch","d-flex","justify-content-center"],["type","checkbox","disabled","",1,"form-check-input",3,"checked"],[1,"d-flex","justify-content-center","gap-2"],[1,"btn","btn-outline-dark","rounded-pill","px-3","d-inline-flex","align-items-center","gap-2",3,"click"],[1,"fa-solid","fa-pen-to-square"],[1,"btn","btn-outline-secondary","rounded-pill","px-3","d-inline-flex","align-items-center","gap-2",3,"click"],[1,"fa-solid","fa-trash"],["colspan","7",1,"text-center","py-4","text-muted"]],template:function(e,r){e&1&&(y(0,"app-loading-screen",0),a(1,"div",1)(2,"div",2)(3,"div")(4,"h3",3),n(5,"Variables de C\xE1lculo"),i(),a(6,"p",4),n(7," Filtra y gestiona las variables que intervienen en los c\xE1lculos del sistema. "),i()(),a(8,"button",5),m("click",function(){return r.crear()}),n(9," Nueva variable "),i()(),a(10,"div",6)(11,"div",7)(12,"table",8)(13,"thead",9)(14,"tr")(15,"th",10),n(16,"VARIABLE"),i(),a(17,"th",10),n(18,"DESCRIPCION"),i(),a(19,"th",10),n(20,"VALOR"),i(),a(21,"th",10),n(22,"TIPO"),i(),a(23,"th",10),n(24,"APLICA PARA"),i(),a(25,"th",11),n(26,"ACTIVO"),i(),a(27,"th",11),n(28,"ACCIONES"),i()()(),a(29,"tbody"),E(30,oe,22,6,"tr",null,ne,!1,le,3,0,"tr"),i()()(),a(33,"div",12)(34,"span",13),n(35),i()()()()),e&2&&(_("messageInput","Cargando...")("loading",r.cargando),s(30),C(r.variables),s(5),I("Mostrando ",r.variables.length," registros"))},dependencies:[Z,J],encapsulation:2})};export{$ as Variables};
