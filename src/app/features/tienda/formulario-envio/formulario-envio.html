<app-loading-screen [loading]="cargando" [messageInput]="'Cargando...'"></app-loading-screen>

<div class="container-fluid min-vh-100 p-4 my-5">
    <div class="row justify-content-center">
        <div class="col-xxl-6 col-xl-7 col-lg-8 col-md-10">
            <div class="bg-white border-1 p-4">
                <!-- Header -->
                <div class="mb-4 pb-3 border-bottom">
                    <button 
                        class="btn btn-link text-dark p-0 mb-3 fw-semibold text-decoration-none text-start"
                        (click)="atras()"
                    >
                        <i class="fas fa-arrow-left me-2"></i> Volver
                    </button>
                    <h1 class="h2 fw-bold text-dark mb-2">Prepagado Kia</h1>
                    <p class="text-muted mb-0">¿Dónde podemos enviarte la tarjeta de Prepagado?</p>
                </div>

                <!-- Formulario -->
                <div class="row g-4">
                    <!-- Tipo Dirección -->
                    @if (cliente.nombre) {
                        <div class="col-md-4">
                            <label class="input-kia-label text-dark">Tipo de Dirección</label>
                            <div ngbDropdown class="d-inline-block w-100">
                                <button 
                                    type="button" 
                                    class="input-kia-field w-100 text-start d-flex justify-content-between align-items-center"
                                    id="dropdownDireccion" 
                                    ngbDropdownToggle
                                >
                                    <span>{{ cliente.direccion?.callePrincipal ? cliente.direccion?.callePrincipal : 'Seleccionar tipo' }}</span>
                                </button>
                                <div 
                                    style="min-width: 100%; max-height: 300px;" 
                                    class="border-0 shadow-sm mt-2 overflow-auto" 
                                    ngbDropdownMenu 
                                    aria-labelledby="dropdownDireccion"
                                > 
                                    @for (tipo of listaTipoDireccion; track $index) {
                                        <button
                                            class="dropdown-item py-3 border-bottom" 
                                            ngbDropdownItem
                                            (click)="seleccionTipoDireccion(tipo.tipo)"
                                        >
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span class="fw-semibold">{{ tipo.tipo }}</span>
                                                <span class="text-muted small">{{ tipo.nombre }}</span>
                                            </div>
                                        </button>
                                    }
                                </div>
                            </div>
                        </div>
                    }

                    <!-- Calle Secundaria -->
                    @if (cliente.direccion) {
                        <div class="col-md-4">
                            <div class="input-kia">
                                <label class="input-kia-label">Número o nombre calle</label>
                                <input [(ngModel)]="cliente.direccion.calleSecundaria" 
                                    type="text" 
                                    class="input-kia-field" 
                                    placeholder=" "
                                >
                            </div>
                        </div>
                    }

                    <!-- Número -->
                    @if (cliente.direccion) {
                        <div class="col-md-4">
                            <div class="input-kia">
                                <label class="input-kia-label">Número</label>
                                <input [(ngModel)]="cliente.direccion.numero" 
                                    type="text" 
                                    class="input-kia-field" 
                                    placeholder=" "
                                >
                            </div>
                        </div>
                    }

                    <!-- Información Adicional -->
                    @if (cliente.direccion) {
                        <div class="col-12">
                            <div class="input-kia">
                                <label class="input-kia-label">Información adicional</label>
                                <input [(ngModel)]="cliente.direccion.otros" 
                                    type="text" 
                                    class="input-kia-field" 
                                    placeholder=" "
                                >
                            </div>
                        </div>
                    }

                    <!-- Barrio -->
                    @if (cliente.direccion) {
                        <div class="col-12">
                            <div class="input-kia">
                                <label class="input-kia-label">Barrio</label>
                                <input [(ngModel)]="cliente.direccion.barrio" 
                                    type="text" 
                                    class="input-kia-field" 
                                    placeholder=" "
                                >
                            </div>
                        </div>
                    }

                    <!-- Ciudad -->
                    @if (cliente.direccion) {
                        <div class="col-12">
                            <div class="input-kia">
                                <label class="input-kia-label">Ciudad</label>
                                <input [(ngModel)]="cliente.direccion.ciudad" 
                                    type="text" 
                                    class="input-kia-field" 
                                    placeholder=" "
                                >
                            </div>
                        </div>
                    }

                    <!-- Departamento -->
                    @if (cliente.direccion) {
                        <div class="col-12">
                            <div class="input-kia">
                                <label class="input-kia-label">Departamento</label>
                                <input [(ngModel)]="cliente.direccion.departamento" 
                                    type="text" 
                                    class="input-kia-field" 
                                    placeholder=" "
                                >
                            </div>
                        </div>
                    }
                </div>

                <!-- Botón Siguiente -->
                <div class="d-flex justify-content-end mt-5 pt-3 border-top">
                    <button
                        class="boton-principal-kia d-flex align-items-center gap-3"
                        (click)="guardarCliente()"
                    >
                        <span>Siguiente</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>